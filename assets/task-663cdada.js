import{p as $}from"./video-60794872.js";import{i as P,j as U,p as j}from"./video-e47daf95.js";import{_ as O,r as y,f as s,o as k,c as R,a as g,g as t,w as a,j as u,t as c,h as A,s as K,n as L,F as Q,x as G,E as w,q as H,p as J,k as W}from"./index-4f763a64.js";import"./request-6a55ce14.js";const X=m=>(J("data-v-86e053b5"),m=m(),W(),m),Y=X(()=>g("br",null,null,-1)),Z={class:"dialog-footer"},ee={__name:"task",setup(m){const n=y({total:0,data:[],query:{limit:20,page:1,order:null,fileId:null,transcodeId:null},querySelect:{status:{"-1":"转码失败",0:"转码中",1:"转码成功"}}}),C=l=>{n.value.query.fileName=null,n.value.query.fileMd5=null,n.value.query.order=null,i()},q=l=>{n.value.query.page=l,i()},x=l=>{n.value.query.limit=l,i()},V=({column:l,prop:o,order:p})=>{let d="";p==="descending"?d="-":p==="ascending"&&(d="+"),n.value.query.order=d+o,i()},i=()=>{P(n.value.query).then(l=>{n.value.data=l.data,n.value.total=l.total})},I=l=>{G.confirm("请仔细确认是否删除 "+l.name+" ?","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{U({id:l.id}).then(o=>{w.warning(o),i()})})},_=y(!1),h=y({}),S=l=>{h.value={autoplay:!0,controls:!0,sources:[l],html5:{vhs:{cacheEncryptionKeys:!0}}},_.value=!0},T=l=>{const o=document.createElement("textarea");o.value=l,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),w.info("复制成功")},B=l=>{l.status===0?j({id:l.id}).then(o=>{l.progress=Math.floor(o.progress)}):l.status===1&&S(l.OutFile)};return i(),(l,o)=>{const p=s("el-input"),d=s("el-form-item"),f=s("el-button"),F=s("el-form"),r=s("el-table-column"),v=s("el-link"),z=s("el-progress"),D=s("el-table"),E=s("el-pagination"),N=s("el-main"),M=s("el-dialog");return k(),R(Q,null,[g("div",null,[t(F,{inline:!0},{default:a(()=>[t(d,{label:"源文件"},{default:a(()=>[t(p,{modelValue:n.value.query.fileId,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value.query.fileId=e),placeholder:"源文件",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"编码器"},{default:a(()=>[t(p,{modelValue:n.value.query.transcodeId,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.query.transcodeId=e),placeholder:"编码器",clearable:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(f,{type:"primary",icon:"search",onClick:i},{default:a(()=>[u(" 查询 ")]),_:1}),t(f,{type:"info",icon:"Refresh",onClick:C},{default:a(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1})]),t(N,{class:"ea-table"},{default:a(()=>[t(D,{data:n.value.data,onSortChange:V},{default:a(()=>[t(r,{fixed:"",prop:"id",label:"ID",width:"80",sortable:"custom",align:"center"}),t(r,{prop:"fileId",label:"文件","min-width":"180",align:"center"},{default:a(e=>[u(c(e.row.VideoFile.fileName),1)]),_:1}),t(r,{prop:"transcodeId",label:"编码器","min-width":"80",align:"center"},{default:a(e=>[u(c(e.row.VideoTranscode.name),1)]),_:1}),t(r,{prop:"status",label:"状态",width:"80",align:"center"},{default:a(e=>[t(v,{type:e.row.status>0?"success":"danger",onClick:b=>B(e.row)},{default:a(()=>[u(c(n.value.querySelect.status[e.row.status]),1)]),_:2},1032,["type","onClick"]),e.row.status==0&&e.row.progress?(k(),A(z,{key:0,type:"circle",percentage:e.row.progress,width:60},null,8,["percentage"])):K("",!0)]),_:1}),t(r,{label:"执行参数","min-width":"180","header-align":"center"},{default:a(e=>[g("pre",null,c(e.row.options),1)]),_:1}),t(r,{label:"输出文件路径","min-width":"260",align:"center"},{default:a(e=>[t(v,{onClick:b=>T(e.row.outFile)},{default:a(()=>[u(c(e.row.outFile)+" ["+c(L(H)(e.row.outSize))+"] ",1)]),_:2},1032,["onClick"])]),_:1}),t(r,{prop:"createdAt",label:"创建日期","min-width":"170",align:"center"}),t(r,{fixed:"right",label:"操作",width:"120"},{default:a(e=>[t(f,{link:"",type:"danger",onClick:b=>I(e.row)},{default:a(()=>[u(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Y,t(E,{background:"",layout:"total, sizes, prev, pager, next",total:n.value.total,"page-size":n.value.query.limit,onCurrentChange:q,onSizeChange:x},null,8,["total","page-size"])]),_:1}),t(M,{modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=e=>_.value=e),title:"播放",width:"40%","destroy-on-close":"",center:""},{footer:a(()=>[g("span",Z,[t(f,{type:"primary",onClick:o[2]||(o[2]=e=>_.value=!1)},{default:a(()=>[u(" 关闭 ")]),_:1})])]),default:a(()=>[t($,{options:h.value},null,8,["options"])]),_:1},8,["modelValue"])],64)}}},ne=O(ee,[["__scopeId","data-v-86e053b5"]]);export{ne as default};
