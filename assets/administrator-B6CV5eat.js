import{s as g,r as y,f as u,o as _,c as w,g as l,w as o,j as p,a as x,h as C,x as P,F as S,y as j,E as v,z as Q}from"./index-D49xtTUg.js";import{g as G}from"./permission-3w1T3R9o.js";const H=s=>g({url:"/system/admin",method:"get",params:s}),J=s=>g({url:"/system/admin",method:"post",data:s}),K=s=>g({url:"/system/admin",method:"put",data:s}),O=s=>g({url:"/system/admin",method:"delete",params:s}),W=x("br",null,null,-1),X={class:"dialog-footer"},ee={__name:"administrator",setup(s){const i=y({total:0,query:{limit:20,page:1,order:null,email:null},data:[]}),R=()=>{i.value.query.email=null,d()},A=n=>{i.value.query.page=n,d()},q=n=>{i.value.query.limit=n,d()},U=({column:n,prop:a,order:m})=>{let r="";m==="descending"?r="-":m==="ascending"&&(r="+"),i.value.query.order=r+a,d()},d=()=>{H(i.value.query).then(n=>{i.value.data=n.data,i.value.total=n.total})},h=y(null),e=y({visible:!1,title:"dialog",form:{},formRule:{email:[{required:!0,message:"邮箱",trigger:"blur"},{min:5,message:"用户名最少为5个字符",trigger:"blur"}],adminRoleId:[{required:!0,message:"角色",trigger:"blur"}]},formAction:"add",roleSelect:{value:null,loading:!1,options:[]}}),B=()=>{e.value.title="创建数据",e.value.visible=!0,e.value.formAction="add",e.value.form={}},z=n=>{if(n.adminRoleId<1){v.warning("超级管理员不允许被编辑");return}e.value.title="创建数据",e.value.visible=!0,e.value.formAction="edit",e.value.form=n},D=n=>{if(n.id<=1){v.warning("超级管理员不允许被编辑");return}Q.confirm(`请仔细确认是否删除管理员《${n.email}》 ?`,"警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{O({id:n.id}).then(a=>{v.warning(a),d()})})},I=()=>{h.value.validate(n=>{n?e.value.formAction==="add"?J(e.value.form).then(a=>{e.value.visible=!1,v.info(a),d()}):e.value.formAction==="edit"?(K(e.value.form).then(a=>{e.value.visible=!1,v.info(a),d()}),e.value.visible=!1):v.info("提交错误"):v.error("请输入正确的数据！")})},E=async n=>{const a=await G({page:1,limit:20,name:n});e.value.roleSelect.options=a.data};return d(),(n,a)=>{const m=u("el-input"),r=u("el-form-item"),c=u("el-button"),V=u("el-form"),f=u("el-table-column"),k=u("el-switch"),N=u("el-table"),T=u("el-pagination"),$=u("el-main"),F=u("el-option"),L=u("el-select"),M=u("el-dialog");return _(),w(S,null,[l(V,{inline:!0},{default:o(()=>[l(r,{label:"管理员"},{default:o(()=>[l(m,{modelValue:i.value.query.email,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.query.email=t),placeholder:"管理员邮箱",clearable:""},null,8,["modelValue"])]),_:1}),l(r,null,{default:o(()=>[l(c,{type:"primary",icon:"search",onClick:d},{default:o(()=>[p(" 查询 ")]),_:1}),l(c,{type:"info",icon:"Refresh",onClick:R},{default:o(()=>[p(" 重置 ")]),_:1})]),_:1})]),_:1}),l($,{class:"ea-table"},{default:o(()=>[l(c,{type:"primary",icon:"Plus",onClick:B},{default:o(()=>[p(" 新增 ")]),_:1}),l(N,{data:i.value.data,style:{width:"100%"},onSortChange:U},{default:o(()=>[l(f,{prop:"id",label:"ID",width:"80",sortable:"custom"}),l(f,{prop:"email",label:"邮箱","min-width":"240"}),l(f,{prop:"nickname",label:"名称","min-width":"160"}),l(f,{prop:"AdminRole.name",label:"权限","min-width":"160"}),l(f,{prop:"status",label:"状态","min-width":"120"},{default:o(t=>[l(k,{modelValue:t.row.status,"onUpdate:modelValue":b=>t.row.status=b,"active-value":1,"inactive-value":0,size:"large","inline-prompt":"","active-text":"启用","inactive-text":"禁用",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"createdAt",label:"创建日期",width:"200"}),l(f,{fixed:"right",label:"操作",width:"120"},{default:o(t=>[l(c,{link:"",type:"primary",onClick:b=>z(t.row)},{default:o(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),l(c,{link:"",type:"danger",onClick:b=>D(t.row)},{default:o(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),W,l(T,{background:"",layout:"total, sizes, prev, pager, next",total:i.value.total,"default-page-size":i.value.query.limit,onCurrentChange:A,onSizeChange:q},null,8,["total","default-page-size"])]),_:1}),l(M,{modelValue:e.value.visible,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.visible=t),title:e.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:""},{footer:o(()=>[x("span",X,[l(c,{onClick:a[6]||(a[6]=t=>e.value.visible=!1)},{default:o(()=>[p("取消")]),_:1}),l(c,{type:"primary",onClick:I},{default:o(()=>[p("确定")]),_:1})])]),default:o(()=>[l(V,{ref_key:"dialogRef",ref:h,model:e.value.form,rules:e.value.formRule},{default:o(()=>[l(r,{label:"邮箱",prop:"email"},{default:o(()=>[l(m,{modelValue:e.value.form.email,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.form.email=t)},null,8,["modelValue"])]),_:1}),e.value.formAction=="add"?(_(),C(r,{key:0,label:"密码",prop:"passwd"},{default:o(()=>[l(m,{modelValue:e.value.form.passwd,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.form.passwd=t)},null,8,["modelValue"])]),_:1})):P("",!0),l(r,{label:"昵称",prop:"nickname"},{default:o(()=>[l(m,{modelValue:e.value.form.nickname,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.form.nickname=t)},null,8,["modelValue"])]),_:1}),l(r,{label:"权限",prop:"adminRoleId"},{default:o(()=>[l(L,{modelValue:e.value.form.adminRoleId,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.form.adminRoleId=t),filterable:"",remote:"","remote-show-suffix":"",placeholder:"输入权限名称来搜索权限列表","remote-method":E,loading:e.value.roleSelect.loading},{default:o(()=>[(_(!0),w(S,null,j(e.value.roleSelect.options,t=>(_(),C(F,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(r,{label:"状态",prop:"status"},{default:o(()=>[l(k,{modelValue:e.value.form.status,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.form.status=t),"active-value":1,"inactive-value":0,"active-text":"启用账号","inactive-text":"禁用账号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{ee as default};
