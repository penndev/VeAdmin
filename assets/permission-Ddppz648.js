import{g as G,a as H,d as J,p as K,b as O}from"./permission-BtMcjh-O.js";import{u as W,r as V,f as u,o as v,c as b,a as g,g as t,w as o,j as f,F as h,z as k,B as X,E as _,A as Y,h as C,t as R}from"./index-ebzyugJO.js";const Z=g("br",null,null,-1),ee=g("br",null,null,-1),le=g("br",null,null,-1),te={class:"dialog-footer"},re={__name:"permission",setup(ae){const A=W(),B=n=>{for(const e of A.getRoutes())if(e.path===n)return e.meta.title??n},r=V({total:0,query:{limit:20,page:1,order:null,email:null},data:[]}),U=()=>{r.value.query.email=null,d()},D=n=>{r.value.query.page=n,d()},$=n=>{r.value.query.limit=n,d()},z=({column:n,prop:e,order:m})=>{let i="";m==="descending"?i="-":m==="ascending"&&(i="+"),r.value.query.order=i+e,d()},d=()=>{G(r.value.query).then(n=>{r.value.data=n.data,r.value.total=n.total})},w=V(null),l=V({visible:!1,title:"dialog",form:{},formRule:{name:[{required:!0,message:"管理员名称",trigger:"blur"},{min:2,message:"名称最少为2个字符",trigger:"blur"}]},formAction:"add",routeValue:[]});(()=>{H().then(n=>{const e=n.data;for(const m of e)m.id=m.path+"."+m.method;l.value.routeValue=e}).catch(n=>{_.error("获取后端路由列表失败！")})})();const E=()=>{l.value.title="创建数据",l.value.visible=!0,l.value.formAction="add",l.value.form={}},T=n=>{l.value.title="编辑数据",l.value.visible=!0,l.value.formAction="edit";for(const e of n.route)e.id=e.path+"."+e.method;l.value.form=n},F=n=>{Y.confirm(`请仔细确认是否删除 (${n.name}) ?`,"警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{J({id:n.id}).then(e=>{_.warning(e),d()})})},M=()=>{w.value.validate(n=>{for(const e of l.value.form.route)delete e.id;n?l.value.formAction==="add"?K(l.value.form).then(e=>{l.value.visible=!1,_.info(e),d()}):l.value.formAction==="edit"?(O(l.value.form).then(e=>{l.value.visible=!1,_.info(e),d()}),l.value.visible=!1):_.info("提交错误"):_.error("请输入正确的数据！")})};return d(),(n,e)=>{const m=u("el-input"),i=u("el-form-item"),c=u("el-button"),x=u("el-form"),p=u("el-table-column"),q=u("el-switch"),S=u("el-tag"),N=u("el-table"),L=u("el-pagination"),P=u("el-main"),j=u("el-option"),I=u("el-select"),Q=u("el-dialog");return v(),b(h,null,[g("div",null,[t(x,{inline:!0},{default:o(()=>[t(i,{label:"角色名称"},{default:o(()=>[t(m,{modelValue:r.value.query.email,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.query.email=a),placeholder:"角色名称",clearable:""},null,8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(c,{type:"primary",icon:"search",onClick:d},{default:o(()=>[f(" 查询 ")]),_:1}),t(c,{type:"info",icon:"Refresh",onClick:U},{default:o(()=>[f(" 重置 ")]),_:1})]),_:1})]),_:1})]),t(P,{class:"ea-table"},{default:o(()=>[t(c,{type:"primary",icon:"Plus",onClick:E},{default:o(()=>[f(" 新建角色 ")]),_:1}),t(N,{data:r.value.data,style:{width:"100%"},onSortChange:z},{default:o(()=>[t(p,{prop:"id",label:"ID",width:"80",sortable:"custom"}),t(p,{prop:"name",label:"名称",width:"150"}),t(p,{prop:"status",label:"状态",width:"120"},{default:o(a=>[t(q,{modelValue:a.row.status,"onUpdate:modelValue":s=>a.row.status=s,"active-value":1,"inactive-value":0,size:"large","inline-prompt":"","active-text":"启用","inactive-text":"禁用",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{prop:"menu",label:"菜单组"},{default:o(a=>[(v(!0),b(h,null,k(a.row.menu,(s,y)=>(v(),C(S,{key:y,style:{margin:"1px"}},{default:o(()=>[f(R(B(s)),1)]),_:2},1024))),128))]),_:1}),t(p,{prop:"route",label:"路由组"},{default:o(a=>[(v(!0),b(h,null,k(a.row.route,(s,y)=>(v(),C(S,{key:y,style:{margin:"1px"}},{default:o(()=>[f(R(s.path)+" - "+R(s.method),1)]),_:2},1024))),128))]),_:1}),t(p,{prop:"createdAt",label:"创建日期",width:"200"}),t(p,{fixed:"right",label:"操作",width:"120"},{default:o(a=>[t(c,{link:"",type:"primary",onClick:s=>T(a.row)},{default:o(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),t(c,{link:"",type:"danger",onClick:s=>F(a.row)},{default:o(()=>[f(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Z,t(L,{background:"",layout:"total, sizes, prev, pager, next",total:r.value.total,"default-page-size":r.value.query.limit,onCurrentChange:D,onSizeChange:$},null,8,["total","default-page-size"])]),_:1}),t(Q,{modelValue:l.value.visible,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.visible=a),title:l.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:""},{footer:o(()=>[g("span",te,[t(c,{onClick:e[5]||(e[5]=a=>l.value.visible=!1)},{default:o(()=>[f("取消")]),_:1}),t(c,{type:"primary",onClick:M},{default:o(()=>[f("确定")]),_:1})])]),default:o(()=>[t(x,{ref_key:"dialogRef",ref:w,model:l.value.form,rules:l.value.formRule},{default:o(()=>[t(i,{label:"名称",prop:"name"},{default:o(()=>[t(m,{modelValue:l.value.form.name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.form.name=a)},null,8,["modelValue"])]),_:1}),t(i,{label:"状态",prop:"status"},{default:o(()=>[t(q,{modelValue:l.value.form.status,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.form.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),t(i,{label:"前端菜单",prop:"menu"},{default:o(()=>[t(X,{modelValue:l.value.form.menu,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.form.menu=a),filterable:"",placeholder:"开放菜单",multiple:""},null,8,["modelValue"]),ee]),_:1}),le,t(i,{label:"路由组",prop:"route"},{default:o(()=>[t(I,{modelValue:l.value.form.route,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.form.route=a),filterable:"",multiple:"",placeholder:"后端访问路由组","value-key":"id"},{default:o(()=>[(v(!0),b(h,null,k(l.value.routeValue,(a,s)=>(v(),C(j,{key:s,label:`${a.path} - [${a.method}]`,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{re as default};
