import{p as $}from"./video-DGfwd8iX.js";import{i as O,j as P,p as U}from"./video-tiwOvQ8W.js";import{_ as j,r as h,f as s,o as k,c as R,a as g,g as t,w as o,j as u,t as c,h as A,x as K,q as L,F as Q,z as G,E as w,v as H,p as J,k as W}from"./index-D49xtTUg.js";const X=m=>(J("data-v-caf146ee"),m=m(),W(),m),Y=X(()=>g("br",null,null,-1)),Z={class:"dialog-footer"},ee={__name:"task",setup(m){const n=h({total:0,data:[],query:{limit:20,page:1,order:null,fileId:null,transcodeId:null},querySelect:{status:{"-1":"转码失败",0:"排队中",1:"转码中",2:"转码完成"}}}),C=l=>{n.value.query.fileName=null,n.value.query.fileMd5=null,n.value.query.order=null,i()},q=l=>{n.value.query.page=l,i()},V=l=>{n.value.query.limit=l,i()},x=({column:l,prop:a,order:p})=>{let d="";p==="descending"?d="-":p==="ascending"&&(d="+"),n.value.query.order=d+a,i()},i=()=>{O(n.value.query).then(l=>{n.value.data=l.data,n.value.total=l.total})},I=l=>{G.confirm("请仔细确认是否删除 "+l.name+" ?","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{P({id:l.id}).then(a=>{w.warning(a),i()})})},_=h(!1),y=h({}),S=l=>{y.value={autoplay:!0,controls:!0,sources:[l],html5:{vhs:{cacheEncryptionKeys:!0}}},_.value=!0},T=l=>{const a=document.createElement("textarea");a.value=l,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),w.info("复制成功")},z=l=>{l.status===1?U({id:l.id}).then(a=>{l.progress=Math.floor(a.progress),a.finishedOn>1&&(l.status=2)}):l.status===2&&S(l.OutFile)};return i(),(l,a)=>{const p=s("el-input"),d=s("el-form-item"),f=s("el-button"),B=s("el-form"),r=s("el-table-column"),v=s("el-link"),F=s("el-progress"),D=s("el-table"),E=s("el-pagination"),N=s("el-main"),M=s("el-dialog");return k(),R(Q,null,[g("div",null,[t(B,{inline:!0},{default:o(()=>[t(d,{label:"源文件"},{default:o(()=>[t(p,{modelValue:n.value.query.fileId,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value.query.fileId=e),placeholder:"源文件",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"编码器"},{default:o(()=>[t(p,{modelValue:n.value.query.transcodeId,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value.query.transcodeId=e),placeholder:"编码器",clearable:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(f,{type:"primary",icon:"search",onClick:i},{default:o(()=>[u(" 查询 ")]),_:1}),t(f,{type:"info",icon:"Refresh",onClick:C},{default:o(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1})]),t(N,{class:"ea-table"},{default:o(()=>[t(D,{data:n.value.data,onSortChange:x},{default:o(()=>[t(r,{fixed:"",prop:"id",label:"ID",width:"80",sortable:"custom",align:"center"}),t(r,{prop:"fileId",label:"文件","min-width":"180",align:"center"},{default:o(e=>[u(c(e.row.VideoFile.fileName),1)]),_:1}),t(r,{prop:"transcodeId",label:"编码器","min-width":"80",align:"center"},{default:o(e=>[u(c(e.row.VideoTranscode.name),1)]),_:1}),t(r,{prop:"status",label:"状态",width:"80",align:"center"},{default:o(e=>[t(v,{type:e.row.status>0?"success":"danger",onClick:b=>z(e.row)},{default:o(()=>[u(c(n.value.querySelect.status[e.row.status]),1)]),_:2},1032,["type","onClick"]),e.row.status==1&&e.row.progress?(k(),A(F,{key:0,type:"circle",percentage:e.row.progress,width:60},null,8,["percentage"])):K("",!0)]),_:1}),t(r,{label:"执行参数","min-width":"180","header-align":"center"},{default:o(e=>[g("pre",null,c(e.row.options),1)]),_:1}),t(r,{label:"输出文件路径","min-width":"260",align:"center"},{default:o(e=>[t(v,{onClick:b=>T(e.row.outFile)},{default:o(()=>[u(c(e.row.outFile)+" ["+c(L(H)(e.row.outSize))+"] ",1)]),_:2},1032,["onClick"])]),_:1}),t(r,{prop:"createdAt",label:"创建日期","min-width":"170",align:"center"}),t(r,{fixed:"right",label:"操作",width:"120"},{default:o(e=>[t(f,{link:"",type:"danger",onClick:b=>I(e.row)},{default:o(()=>[u(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Y,t(E,{background:"",layout:"total, sizes, prev, pager, next",total:n.value.total,"page-size":n.value.query.limit,onCurrentChange:q,onSizeChange:V},null,8,["total","page-size"])]),_:1}),t(M,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value=e),title:"播放",width:"40%","destroy-on-close":"",center:""},{footer:o(()=>[g("span",Z,[t(f,{type:"primary",onClick:a[2]||(a[2]=e=>_.value=!1)},{default:o(()=>[u(" 关闭 ")]),_:1})])]),default:o(()=>[t($,{options:y.value},null,8,["options"])]),_:1},8,["modelValue"])],64)}}},oe=j(ee,[["__scopeId","data-v-caf146ee"]]);export{oe as default};
