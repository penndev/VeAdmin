import{g as Z,a as ee,b as le,c as ae,u as B,d as te,e as oe,f as ne}from"./archive-BipOGPVU.js";import{r as q,f as i,o as s,c as _,a as x,g as l,w as o,h as f,j as m,t as k,F as y,v as h,s as C,E as b,x as E}from"./index-3JgF3c3i.js";import"./request-KlnqnHWV.js";const ue=x("br",null,null,-1),de=x("br",null,null,-1),re=x("br",null,null,-1),ie={class:"dialog-footer"},ge={__name:"list",setup(se){const d=q({total:0,query:{limit:20,page:1,order:"-id",id:null,name:null,status:null,updateStart:null,updateEnd:null},data:[]}),$=n=>{d.value.query.page=n,c()},R=n=>{d.value.query.limit=n,c()},z=({column:n,prop:t,order:r})=>{let u="";r==="descending"?u="-":r==="ascending"&&(u="+"),d.value.query.order=u+t,c()},c=()=>{Z(d.value.query).then(n=>{d.value.data=n.data,d.value.total=n.total})},U=q(null),a=q({visible:!1,title:"dialog",vodTypeList:[],vodTypeDict:{},formTempSelectType:null,vodTagList:[],formTempSelectTag:null,form:{},formRule:{name:[{required:!0,message:"名称",trigger:"blur"},{min:2,message:"用户名最少为2个字符",trigger:"blur"}],pic:[{required:!0,message:"封面",trigger:"blur"},{min:2,message:"用户名最少为5个字符",trigger:"blur"}]},formAction:"add"}),N=()=>{ee({name:a.value.formTempSelectTag,page:1,limit:20}).then(n=>{a.value.vodTagList=n.data})},P=n=>{a.value.formTempSelectTag=null,le({archiveTagId:n.id,archiveListId:a.value.form.id}).then(t=>{const r={id:t.data.id,ArchiveTag:n};a.value.form.Tags.push(r),b.info(t.message)})},A=(n,t)=>{ne({id:n}).then(r=>{b.warning(r);const u=t.findIndex(V=>V.id===n);u!==-1&&t.splice(u,1)})},F=()=>{a.value.title="新增资料",a.value.visible=!0,a.value.formAction="add",a.value.form={}},M=n=>{a.value.title="修改资料-"+n.name,a.value.visible=!0,a.value.formAction="edit",a.value.form=n},j=()=>{U.value.validate(n=>{n?a.value.formAction==="add"?ae(a.value.form).then(t=>{a.value.visible=!1,b.success(t),c()}):a.value.formAction==="edit"?(B(a.value.form).then(t=>{a.value.visible=!1,b.info(t),c()}),a.value.visible=!1):b.warning("提交错误"):b.error("请输入正确的数据！")})},G=n=>{const t=()=>{B({id:n.id,status:!n.status}).then(r=>{n.status=!n.status,b.info(r)})};n.status?E.confirm("请仔细确认是否下架 "+n.name+" ?","警告",{confirmButtonText:"下架",cancelButtonText:"取消",type:"warning"}).then(()=>{t()}):t()},H=n=>{E.confirm("请仔细确认是否删除 "+n.fileName+" ?","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{te({id:n.id}).then(t=>{b.warning(t),c()})})};return(()=>{oe({limit:9999}).then(n=>{a.value.vodTypeList=n.data;for(const t of n.data)a.value.vodTypeDict[t.id]=t.name})})(),c(),(n,t)=>{const r=i("el-input"),u=i("el-form-item"),V=i("el-option"),w=i("el-select"),D=i("el-date-picker"),T=i("el-button"),I=i("el-form"),g=i("el-table-column"),J=i("el-image"),K=i("el-link"),L=i("el-tag"),O=i("el-table"),Q=i("el-pagination"),W=i("el-main"),X=i("el-switch"),p=i("el-col"),S=i("el-row"),Y=i("el-dialog");return s(),_(y,null,[x("div",null,[l(I,{inline:!0},{default:o(()=>[l(u,{label:"ID"},{default:o(()=>[l(r,{modelValue:d.value.query.id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value.query.id=e),placeholder:"ID",style:{"max-width":"120px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"名称"},{default:o(()=>[l(r,{modelValue:d.value.query.name,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value.query.name=e),placeholder:"名称",style:{"max-width":"180px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"上架状态"},{default:o(()=>[l(w,{modelValue:d.value.query.status,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value.query.status=e),placeholder:"上架状态",clearable:"",style:{"max-width":"150px"}},{default:o(()=>[(s(),f(V,{key:0,label:"下架",value:0})),(s(),f(V,{key:1,label:"上架",value:1}))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"日期"},{default:o(()=>[l(D,{modelValue:d.value.query.updateStart,"onUpdate:modelValue":t[3]||(t[3]=e=>d.value.query.updateStart=e),type:"datetime",placeholder:"选择开始时间",style:{"max-width":"180px"}},null,8,["modelValue"]),m("   "),l(D,{modelValue:d.value.query.updateEnd,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value.query.updateEnd=e),type:"datetime",placeholder:"选择结束时间",style:{"max-width":"180px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(T,{type:"primary",icon:"search",onClick:c},{default:o(()=>[m(" 查询 ")]),_:1})]),_:1})]),_:1})]),l(W,{class:"ea-table"},{default:o(()=>[l(T,{type:"primary",icon:"Plus",onClick:F},{default:o(()=>[m(" 新增 ")]),_:1}),l(O,{data:d.value.data,onSortChange:z},{default:o(()=>[l(g,{label:"ID",prop:"id",fixed:"",width:"80",sortable:"custom"}),l(g,{label:"名称",prop:"name",align:"center"}),l(g,{label:"分类",align:"center"},{default:o(e=>[m(k(a.value.vodTypeDict[e.row.archiveCategoryId]??"未知"),1)]),_:1}),l(g,{label:"封面",align:"center"},{default:o(e=>[l(J,{src:e.row.Pic,"zoom-rate":1.2,"preview-src-list":[e.row.Pic],fit:"cover",style:{width:"60px","min-height":"90px"}},null,8,["src","preview-src-list"])]),_:1}),l(g,{label:"上架状态",align:"center"},{default:o(e=>[l(K,{type:e.row.status>0?"success":"danger",onClick:v=>G(e.row)},{default:o(()=>[m(k(e.row.status>0?e.row.status>1?e.row.status:"上架":"下架"),1)]),_:2},1032,["type","onClick"])]),_:1}),l(g,{label:"标签",width:"250",align:"center"},{default:o(e=>[(s(!0),_(y,null,h(e.row.Tags,v=>(s(),f(L,{key:v.id,closable:"",style:{margin:"2px 3px"},onClose:pe=>A(v.id,e.row.Tags)},{default:o(()=>[m(k(v==null?void 0:v.ArchiveTag.name),1)]),_:2},1032,["onClose"]))),128))]),_:1}),l(g,{label:"最近更新",prop:"updatedAt",width:"200",align:"center"}),l(g,{label:"操作",fixed:"right",width:"120"},{default:o(e=>[l(T,{link:"",type:"primary",onClick:v=>M(e.row)},{default:o(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),l(T,{link:"",type:"danger",onClick:v=>H(e.row)},{default:o(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),ue,l(Q,{background:"",layout:"total, sizes, prev, pager, next",total:d.value.total,"page-size":d.value.query.limit,onCurrentChange:$,onSizeChange:R},null,8,["total","page-size"])]),_:1}),l(Y,{modelValue:a.value.visible,"onUpdate:modelValue":t[18]||(t[18]=e=>a.value.visible=e),title:a.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:"",onClose:t[19]||(t[19]=e=>a.value.formTempSelectType=null)},{footer:o(()=>[x("span",ie,[l(T,{onClick:t[17]||(t[17]=e=>a.value.visible=!1)},{default:o(()=>[m("取消")]),_:1}),l(T,{type:"primary",onClick:j},{default:o(()=>[m("确定")]),_:1})])]),default:o(()=>[l(I,{ref_key:"dialogRef",ref:U,model:a.value.form,rules:a.value.formRule,"label-width":"80px"},{default:o(()=>[l(u,{label:"状态",prop:"status"},{default:o(()=>[l(X,{modelValue:a.value.form.status,"onUpdate:modelValue":t[5]||(t[5]=e=>a.value.form.status=e),"active-value":1,"active-text":"上架","inactive-value":0,"inactive-text":"下架"},null,8,["modelValue"])]),_:1}),l(u,{label:"视频分类",prop:"videoTypeId"},{default:o(()=>[l(p,{span:8},{default:o(()=>[l(w,{modelValue:a.value.formTempSelectType,"onUpdate:modelValue":t[6]||(t[6]=e=>a.value.formTempSelectType=e),placeholder:"选一级分类",style:{width:"100%"}},{default:o(()=>[(s(!0),_(y,null,h(a.value.vodTypeList,e=>(s(),_(y,null,[e.parent==0?(s(),f(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])):C("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1}),l(p,{span:2}),l(p,{span:8},{default:o(()=>[a.value.formTempSelectType||a.value.form.archiveCategoryId?(s(),f(w,{key:0,modelValue:a.value.form.archiveCategoryId,"onUpdate:modelValue":t[7]||(t[7]=e=>a.value.form.archiveCategoryId=e),placeholder:"选二级分类"},{default:o(()=>[(s(!0),_(y,null,h(a.value.vodTypeList,e=>(s(),_(y,null,[a.value.form.archiveCategoryId||a.value.formTempSelectType==e.parent||a.value.formTempSelectType==e.id?(s(),f(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])):C("",!0)],64))),256))]),_:1},8,["modelValue"])):C("",!0)]),_:1})]),_:1}),a.value.formAction=="edit"?(s(),f(u,{key:0,label:"标签栏",prop:"status"},{default:o(()=>[(s(!0),_(y,null,h(a.value.form.Tags,e=>(s(),f(L,{key:e.id,closable:"",style:{margin:"6px"},onClose:v=>A(e.id)},{default:o(()=>[m(k(e.ArchiveTag.name),1)]),_:2},1032,["onClose"]))),128)),l(p,{span:8},{default:o(()=>[l(w,{modelValue:a.value.formTempSelectTag,"onUpdate:modelValue":t[8]||(t[8]=e=>a.value.formTempSelectTag=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"搜索标签名称","remote-method":N,onChange:P},{default:o(()=>[(s(!0),_(y,null,h(a.value.vodTagList,e=>(s(),f(V,{key:e.id,label:e.name,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):C("",!0),de,l(S,{gutter:20},{default:o(()=>[l(p,{span:8},{default:o(()=>[l(u,{label:"总集数",prop:"total"},{default:o(()=>[l(r,{modelValue:a.value.form.total,"onUpdate:modelValue":t[9]||(t[9]=e=>a.value.form.total=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),re,l(S,{gutter:20},{default:o(()=>[l(p,{span:12},{default:o(()=>[l(u,{label:"标题",prop:"name"},{default:o(()=>[l(r,{modelValue:a.value.form.name,"onUpdate:modelValue":t[10]||(t[10]=e=>a.value.form.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:12},{default:o(()=>[l(u,{label:"副标题",prop:"sub"},{default:o(()=>[l(r,{modelValue:a.value.form.sub,"onUpdate:modelValue":t[11]||(t[11]=e=>a.value.form.sub=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"封面",prop:"pic"},{default:o(()=>[l(r,{modelValue:a.value.form.pic,"onUpdate:modelValue":t[12]||(t[12]=e=>a.value.form.pic=e)},null,8,["modelValue"])]),_:1}),l(S,{gutter:20},{default:o(()=>[l(p,{span:8},{default:o(()=>[l(u,{label:"年份",prop:"year"},{default:o(()=>[l(r,{modelValue:a.value.form.year,"onUpdate:modelValue":t[13]||(t[13]=e=>a.value.form.year=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:o(()=>[l(u,{label:"语言",prop:"lang"},{default:o(()=>[l(r,{modelValue:a.value.form.lang,"onUpdate:modelValue":t[14]||(t[14]=e=>a.value.form.lang=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:o(()=>[l(u,{label:"地区",prop:"area"},{default:o(()=>[l(r,{modelValue:a.value.form.area,"onUpdate:modelValue":t[15]||(t[15]=e=>a.value.form.area=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"内容简介",prop:"content",width:"100"},{default:o(()=>[l(r,{modelValue:a.value.form.content,"onUpdate:modelValue":t[16]||(t[16]=e=>a.value.form.content=e),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{ge as default};
