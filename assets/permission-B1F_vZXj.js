import{g as X,d as Y,p as Z,a as ee}from"./permission-BMFSn2yb.js";import{u as le,r as w,f as u,o as r,c,a as b,g as t,w as a,j as m,F as _,v as y,n as te,x as ae,E as V,h as k,t as x,s as C}from"./index-BbEghTQX.js";import"./request-F_wI59qa.js";const oe=b("br",null,null,-1),ne=b("br",null,null,-1),ue=b("br",null,null,-1),re=b("small",null,"输入后端开发预留的全路径部分接口地址！例 `/admin/add | *` ",-1),ie={class:"dialog-footer"},ce={__name:"permission",setup(se){const R=le(),B=R.getRoutes(),z=n=>{for(const o of B)if(o.path===n)return o.meta.title??n},s=w({total:0,query:{limit:20,page:1,order:null,email:null},data:[]}),E=()=>{s.value.query.email=null,f()},$=n=>{s.value.query.page=n,f()},N=n=>{s.value.query.limit=n,f()},T=({column:n,prop:o,order:h})=>{let p="";h==="descending"?p="-":h==="ascending"&&(p="+"),s.value.query.order=p+o,f()},f=()=>{X(s.value.query).then(n=>{s.value.data=n.data,s.value.total=n.total})},q=w(null),l=w({visible:!1,title:"dialog",form:{},formRule:{name:[{required:!0,message:"管理员名称",trigger:"blur"},{min:2,message:"名称最少为2个字符",trigger:"blur"}]},formAction:"add",tempValue:null}),F=n=>{l.value.form.route.splice(n,1)},M=()=>{l.value.form.route||(l.value.form.route=[]),l.value.form.route.push({path:l.value.tempValue}),l.value.tempValue=""},P=()=>{l.value.title="创建数据",l.value.visible=!0,l.value.formAction="add",l.value.form={}},L=n=>{l.value.title="创建数据",l.value.visible=!0,l.value.formAction="edit",l.value.form=n},j=n=>{ae.confirm(`请仔细确认是否删除 (${n.name}) ?`,"警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{Y({id:n.id}).then(o=>{V.warning(o),f()})})},I=()=>{q.value.validate(n=>{n?l.value.formAction==="add"?Z(l.value.form).then(o=>{l.value.visible=!1,V.info(o),f()}):l.value.formAction==="edit"?(ee(l.value.form).then(o=>{l.value.visible=!1,V.info(o),f()}),l.value.visible=!1):V.info("提交错误"):V.error("请输入正确的数据！")})};return f(),(n,o)=>{const h=u("el-input"),p=u("el-form-item"),v=u("el-button"),S=u("el-form"),g=u("el-table-column"),D=u("el-switch"),A=u("el-tag"),Q=u("el-table"),G=u("el-pagination"),H=u("el-main"),U=u("el-option"),J=u("el-select"),K=u("el-link"),O=u("el-dialog");return r(),c(_,null,[b("div",null,[t(S,{inline:!0},{default:a(()=>[t(p,{label:"角色名称"},{default:a(()=>[t(h,{modelValue:s.value.query.email,"onUpdate:modelValue":o[0]||(o[0]=e=>s.value.query.email=e),placeholder:"角色名称",clearable:""},null,8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(v,{type:"primary",icon:"search",onClick:f},{default:a(()=>[m(" 查询 ")]),_:1}),t(v,{type:"info",icon:"Refresh",onClick:E},{default:a(()=>[m(" 重置 ")]),_:1})]),_:1})]),_:1})]),t(H,{class:"ea-table"},{default:a(()=>[t(v,{type:"primary",icon:"Plus",onClick:P},{default:a(()=>[m(" 新建角色 ")]),_:1}),t(Q,{data:s.value.data,style:{width:"100%"},onSortChange:T},{default:a(()=>[t(g,{prop:"id",label:"ID",width:"80",sortable:"custom"}),t(g,{prop:"name",label:"名称",width:"150"}),t(g,{prop:"status",label:"状态",width:"120"},{default:a(e=>[t(D,{modelValue:e.row.status,"onUpdate:modelValue":i=>e.row.status=i,"active-value":1,"inactive-value":0,size:"large","inline-prompt":"","active-text":"启用","inactive-text":"禁用",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(g,{prop:"menu",label:"菜单组"},{default:a(e=>[(r(!0),c(_,null,y(e.row.menu,(i,d)=>(r(),k(A,{key:d,style:{margin:"1px"}},{default:a(()=>[m(x(z(i)),1)]),_:2},1024))),128))]),_:1}),t(g,{prop:"route",label:"路由组"},{default:a(e=>[(r(!0),c(_,null,y(e.row.route,(i,d)=>(r(),k(A,{key:d,type:"success",style:{margin:"1px"}},{default:a(()=>[m(x(i.path),1)]),_:2},1024))),128))]),_:1}),t(g,{prop:"createdAt",label:"创建日期",width:"200"}),t(g,{fixed:"right",label:"操作",width:"120"},{default:a(e=>[t(v,{link:"",type:"primary",onClick:i=>L(e.row)},{default:a(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),t(v,{link:"",type:"danger",onClick:i=>j(e.row)},{default:a(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),oe,t(G,{background:"",layout:"total, sizes, prev, pager, next",total:s.value.total,"default-page-size":s.value.query.limit,onCurrentChange:$,onSizeChange:N},null,8,["total","default-page-size"])]),_:1}),t(O,{modelValue:l.value.visible,"onUpdate:modelValue":o[6]||(o[6]=e=>l.value.visible=e),title:l.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:""},{footer:a(()=>[b("span",ie,[t(v,{onClick:o[5]||(o[5]=e=>l.value.visible=!1)},{default:a(()=>[m("取消")]),_:1}),t(v,{type:"primary",onClick:I},{default:a(()=>[m("确定")]),_:1})])]),default:a(()=>[t(S,{ref_key:"dialogRef",ref:q,model:l.value.form,rules:l.value.formRule},{default:a(()=>[t(p,{label:"名称",prop:"name"},{default:a(()=>[t(h,{modelValue:l.value.form.name,"onUpdate:modelValue":o[1]||(o[1]=e=>l.value.form.name=e)},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:a(()=>[t(D,{modelValue:l.value.form.status,"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.form.status=e),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),t(p,{label:"前端菜单",prop:"menu"},{default:a(()=>[t(J,{modelValue:l.value.form.menu,"onUpdate:modelValue":o[3]||(o[3]=e=>l.value.form.menu=e),filterable:"",placeholder:"开放菜单",multiple:""},{default:a(()=>[(r(!0),c(_,null,y(te(R).options.routes,(e,i)=>(r(),c(_,null,[e.meta?(r(),c(_,{key:0},[e.meta.title&&(e.meta.path||e.path)&&e.meta.hidden!=!0?(r(),k(U,{key:i,label:e.meta.title+" | "+(e.meta.path??e.path),value:e.meta.path??e.path},null,8,["label","value"])):C("",!0)],64)):C("",!0),e.children?(r(!0),c(_,{key:1},y(e.children,(d,W)=>(r(),c(_,null,[d.meta&&d.meta.title&&d.path&&d.meta.hidden!=!0?(r(),k(U,{key:i+"-"+W,label:(e.meta?e.meta.title+"-":"")+d.meta.title+" | "+d.path,value:d.path},null,8,["label","value"])):C("",!0)],64))),256)):C("",!0)],64))),256))]),_:1},8,["modelValue"]),ne]),_:1}),ue,t(p,{label:"路由组",prop:"route"},{default:a(()=>[(r(!0),c(_,null,y(l.value.form.route,(e,i)=>(r(),c("div",{key:i,style:{"margin-bottom":"8px",width:"100%"}},[t(K,{type:"info"},{default:a(()=>[m(" 路由-> "+x(e.path),1)]),_:2},1024),m("   "),t(v,{size:"small",type:"info",icon:"Delete",circle:"",onClick:d=>F(i)},null,8,["onClick"])]))),128)),t(h,{modelValue:l.value.tempValue,"onUpdate:modelValue":o[4]||(o[4]=e=>l.value.tempValue=e)},{append:a(()=>[t(v,{icon:"Plus",onClick:M})]),_:1},8,["modelValue"]),re]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{ce as default};
