import{g as W,a as X,b as Y,c as Z,u as ee,d as le,e as ae,f as te}from"./archive-3742bd26.js";import{r as q,f as r,o as m,c as _,a as w,g as l,w as o,h as p,j as s,t as C,F as y,v as h,s as S,E as V,x as oe}from"./index-32dea956.js";import"./request-b9a42b87.js";const ue=w("br",null,null,-1),ne=w("br",null,null,-1),de=w("br",null,null,-1),re={class:"dialog-footer"},ce={__name:"list",setup(ie){const d=q({total:0,query:{limit:20,page:1,order:"-id",id:null,name:null,status:null,updateStart:null,updateEnd:null},data:[]}),E=u=>{d.value.query.page=u,v()},B=u=>{d.value.query.limit=u,v()},z=({column:u,prop:t,order:i})=>{let n="";i==="descending"?n="-":i==="ascending"&&(n="+"),d.value.query.order=n+t,v()},v=()=>{W(d.value.query).then(u=>{d.value.data=u.data,d.value.total=u.total})},U=q(null),a=q({visible:!1,title:"dialog",doubanLoadingTitle:"点击获取",vodTypeList:[],vodTypeDict:{},formTempSelectType:null,vodTagList:[],formTempSelectTag:null,form:{},formRule:{name:[{required:!0,message:"名称",trigger:"blur"},{min:2,message:"用户名最少为2个字符",trigger:"blur"}],pic:[{required:!0,message:"封面",trigger:"blur"},{min:2,message:"用户名最少为5个字符",trigger:"blur"}]},formAction:"add"}),R=()=>{X({name:a.value.formTempSelectTag,page:1,limit:20}).then(u=>{a.value.vodTagList=u.data})},$=u=>{a.value.formTempSelectTag=null,Y({archiveTagId:u.id,archiveListId:a.value.form.id}).then(t=>{const i={id:t.data.id,ArchiveTag:u};a.value.form.Tags.push(i),V.info(t.message)})},A=(u,t)=>{te({id:u}).then(i=>{V.warning(i);const n=t.findIndex(b=>b.id===u);n!==-1&&t.splice(n,1)})},N=()=>{a.value.title="新增资料",a.value.visible=!0,a.value.formAction="add",a.value.form={}},P=u=>{a.value.title="修改资料-"+u.name,a.value.visible=!0,a.value.formAction="edit",a.value.form=u},F=()=>{U.value.validate(u=>{u?a.value.formAction==="add"?Z(a.value.form).then(t=>{a.value.visible=!1,V.success(t),v()}):a.value.formAction==="edit"?(ee(a.value.form).then(t=>{a.value.visible=!1,V.info(t),v()}),a.value.visible=!1):V.warning("提交错误"):V.error("请输入正确的数据！")})},M=u=>{oe.confirm("请仔细确认是否删除 "+u.fileName+" ?","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{le({id:u.id}).then(t=>{V.warning(t),v()})})};return(()=>{ae({limit:9999}).then(u=>{a.value.vodTypeList=u.data;for(const t of u.data)a.value.vodTypeDict[t.id]=t.name})})(),v(),(u,t)=>{const i=r("el-input"),n=r("el-form-item"),b=r("el-option"),x=r("el-select"),D=r("el-date-picker"),T=r("el-button"),I=r("el-form"),f=r("el-table-column"),j=r("el-image"),G=r("el-link"),L=r("el-tag"),H=r("el-table"),J=r("el-pagination"),K=r("el-main"),O=r("el-switch"),c=r("el-col"),k=r("el-row"),Q=r("el-dialog");return m(),_(y,null,[w("div",null,[l(I,{inline:!0},{default:o(()=>[l(n,{label:"ID"},{default:o(()=>[l(i,{modelValue:d.value.query.id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value.query.id=e),placeholder:"ID",style:{"max-width":"120px"}},null,8,["modelValue"])]),_:1}),l(n,{label:"名称"},{default:o(()=>[l(i,{modelValue:d.value.query.name,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value.query.name=e),placeholder:"名称",style:{"max-width":"180px"}},null,8,["modelValue"])]),_:1}),l(n,{label:"上架状态"},{default:o(()=>[l(x,{modelValue:d.value.query.status,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value.query.status=e),placeholder:"上架状态",clearable:"",style:{"max-width":"150px"}},{default:o(()=>[(m(),p(b,{key:0,label:"下架",value:0})),(m(),p(b,{key:1,label:"上架",value:1}))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"日期"},{default:o(()=>[l(D,{modelValue:d.value.query.updateStart,"onUpdate:modelValue":t[3]||(t[3]=e=>d.value.query.updateStart=e),type:"datetime",placeholder:"选择开始时间",style:{"max-width":"180px"}},null,8,["modelValue"]),s("   "),l(D,{modelValue:d.value.query.updateEnd,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value.query.updateEnd=e),type:"datetime",placeholder:"选择结束时间",style:{"max-width":"180px"}},null,8,["modelValue"])]),_:1}),l(n,null,{default:o(()=>[l(T,{type:"primary",icon:"search",onClick:v},{default:o(()=>[s(" 查询 ")]),_:1})]),_:1})]),_:1})]),l(K,{class:"ea-table"},{default:o(()=>[l(T,{type:"primary",icon:"Plus",onClick:N},{default:o(()=>[s(" 新增 ")]),_:1}),l(H,{data:d.value.data,onSortChange:z},{default:o(()=>[l(f,{label:"ID",prop:"id",fixed:"",width:"80",sortable:"custom"}),l(f,{label:"名称",prop:"name",align:"center"}),l(f,{label:"分类",align:"center"},{default:o(e=>[s(C(a.value.vodTypeDict[e.row.archiveCategoryId]??"未知"),1)]),_:1}),l(f,{label:"封面",align:"center"},{default:o(e=>[l(j,{src:e.row.Pic,"zoom-rate":1.2,"preview-src-list":[e.row.Pic],fit:"cover",style:{width:"60px","min-height":"90px"}},null,8,["src","preview-src-list"])]),_:1}),l(f,{label:"上架状态",align:"center"},{default:o(e=>[l(G,{type:e.row.status>0?"success":"danger"},{default:o(()=>[s(C(e.row.status>0?e.row.status>1?e.row.status:"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"标签",width:"250",align:"center"},{default:o(e=>[(m(!0),_(y,null,h(e.row.Tags,g=>(m(),p(L,{key:g.id,closable:"",style:{margin:"2px 3px"},onClose:se=>A(g.id,e.row.Tags)},{default:o(()=>[s(C(g==null?void 0:g.ArchiveTag.name),1)]),_:2},1032,["onClose"]))),128))]),_:1}),l(f,{label:"最近更新",prop:"updatedAt",width:"200",align:"center"}),l(f,{label:"操作",fixed:"right",width:"120"},{default:o(e=>[l(T,{link:"",type:"primary",onClick:g=>P(e.row)},{default:o(()=>[s(" 编辑 ")]),_:2},1032,["onClick"]),l(T,{link:"",type:"danger",onClick:g=>M(e.row)},{default:o(()=>[s(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),ue,l(J,{background:"",layout:"total, sizes, prev, pager, next",total:d.value.total,"page-size":d.value.query.limit,onCurrentChange:E,onSizeChange:B},null,8,["total","page-size"])]),_:1}),l(Q,{modelValue:a.value.visible,"onUpdate:modelValue":t[18]||(t[18]=e=>a.value.visible=e),title:a.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:"",onClose:t[19]||(t[19]=e=>a.value.formTempSelectType=null)},{footer:o(()=>[w("span",re,[l(T,{onClick:t[17]||(t[17]=e=>a.value.visible=!1)},{default:o(()=>[s("取消")]),_:1}),l(T,{type:"primary",onClick:F},{default:o(()=>[s("确定")]),_:1})])]),default:o(()=>[l(I,{ref_key:"dialogRef",ref:U,model:a.value.form,rules:a.value.formRule,"label-position":"left","label-width":"80px"},{default:o(()=>[l(n,{label:"状态",prop:"status"},{default:o(()=>[l(O,{modelValue:a.value.form.status,"onUpdate:modelValue":t[5]||(t[5]=e=>a.value.form.status=e),"active-value":1,"active-text":"上架","inactive-value":0,"inactive-text":"下架"},null,8,["modelValue"])]),_:1}),l(n,{label:"视频分类",prop:"videoTypeId"},{default:o(()=>[l(k,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[l(x,{modelValue:a.value.formTempSelectType,"onUpdate:modelValue":t[6]||(t[6]=e=>a.value.formTempSelectType=e),placeholder:"选一级分类"},{default:o(()=>[(m(!0),_(y,null,h(a.value.vodTypeList,e=>(m(),_(y,null,[e.parent==0?(m(),p(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])):S("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1}),l(c,{span:12},{default:o(()=>[a.value.formTempSelectType||a.value.form.archiveCategoryId?(m(),p(x,{key:0,modelValue:a.value.form.archiveCategoryId,"onUpdate:modelValue":t[7]||(t[7]=e=>a.value.form.archiveCategoryId=e),placeholder:"选二级分类"},{default:o(()=>[(m(!0),_(y,null,h(a.value.vodTypeList,e=>(m(),_(y,null,[a.value.form.archiveCategoryId||a.value.formTempSelectType==e.parent||a.value.formTempSelectType==e.id?(m(),p(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])):S("",!0)],64))),256))]),_:1},8,["modelValue"])):S("",!0)]),_:1})]),_:1})]),_:1}),a.value.formAction=="edit"?(m(),p(n,{key:0,label:"标签栏",prop:"status"},{default:o(()=>[(m(!0),_(y,null,h(a.value.form.Tags,e=>(m(),p(L,{key:e.id,closable:"",style:{margin:"6px"},onClose:g=>A(e.id)},{default:o(()=>[s(C(e.ArchiveTag.name),1)]),_:2},1032,["onClose"]))),128)),l(x,{modelValue:a.value.formTempSelectTag,"onUpdate:modelValue":t[8]||(t[8]=e=>a.value.formTempSelectTag=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"搜索标签名称","remote-method":R,size:"small",onChange:$},{default:o(()=>[(m(!0),_(y,null,h(a.value.vodTagList,e=>(m(),p(b,{key:e.id,label:e.name,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0),ne,l(k,{gutter:20},{default:o(()=>[l(c,{span:8},{default:o(()=>[l(n,{label:"总集数",prop:"total"},{default:o(()=>[l(i,{modelValue:a.value.form.total,"onUpdate:modelValue":t[9]||(t[9]=e=>a.value.form.total=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),de,l(k,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[l(n,{label:"标题",prop:"name"},{default:o(()=>[l(i,{modelValue:a.value.form.name,"onUpdate:modelValue":t[10]||(t[10]=e=>a.value.form.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:12},{default:o(()=>[l(n,{label:"副标题",prop:"sub"},{default:o(()=>[l(i,{modelValue:a.value.form.sub,"onUpdate:modelValue":t[11]||(t[11]=e=>a.value.form.sub=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(n,{label:"封面",prop:"pic"},{default:o(()=>[l(i,{modelValue:a.value.form.pic,"onUpdate:modelValue":t[12]||(t[12]=e=>a.value.form.pic=e)},null,8,["modelValue"])]),_:1}),l(k,{gutter:20},{default:o(()=>[l(c,{span:8},{default:o(()=>[l(n,{label:"年份",prop:"year"},{default:o(()=>[l(i,{modelValue:a.value.form.year,"onUpdate:modelValue":t[13]||(t[13]=e=>a.value.form.year=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:8},{default:o(()=>[l(n,{label:"语言",prop:"lang"},{default:o(()=>[l(i,{modelValue:a.value.form.lang,"onUpdate:modelValue":t[14]||(t[14]=e=>a.value.form.lang=e)},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{span:8},{default:o(()=>[l(n,{label:"地区",prop:"area"},{default:o(()=>[l(i,{modelValue:a.value.form.area,"onUpdate:modelValue":t[15]||(t[15]=e=>a.value.form.area=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(n,{label:"内容简介",prop:"content",width:"100"},{default:o(()=>[l(i,{modelValue:a.value.form.content,"onUpdate:modelValue":t[16]||(t[16]=e=>a.value.form.content=e),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{ce as default};
