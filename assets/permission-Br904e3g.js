import{g as G,a as H,d as J,p as K,b as O}from"./permission-CYR9Rl3k.js";import{u as W,r as V,f as u,o as v,c as b,a as g,g as l,w as o,j as f,F as y,y as k,A as X,E as _,z as Y,h as C,t as S}from"./index-VAWsi3PW.js";const Z=g("br",null,null,-1),ee=g("br",null,null,-1),le=g("br",null,null,-1),te={class:"dialog-footer"},re={__name:"permission",setup(ae){const A=W().getRoutes(),U=n=>{for(const t of A)if(t.path===n)return t.meta.title??n},r=V({total:0,query:{limit:20,page:1,order:null,email:null},data:[]}),B=()=>{r.value.query.email=null,s()},D=n=>{r.value.query.page=n,s()},$=n=>{r.value.query.limit=n,s()},z=({column:n,prop:t,order:d})=>{let i="";d==="descending"?i="-":d==="ascending"&&(i="+"),r.value.query.order=i+t,s()},s=()=>{G(r.value.query).then(n=>{r.value.data=n.data,r.value.total=n.total})},R=V(null),e=V({visible:!1,title:"dialog",form:{},formRule:{name:[{required:!0,message:"管理员名称",trigger:"blur"},{min:2,message:"名称最少为2个字符",trigger:"blur"}]},formAction:"add",routeValue:[]});(()=>{H().then(n=>{const t=n.data;for(const d of t)d.id=d.path+"."+d.method;e.value.routeValue=t}).catch(n=>{_.error("获取后端路由列表失败！")})})();const E=()=>{e.value.title="创建数据",e.value.visible=!0,e.value.formAction="add",e.value.form={}},T=n=>{e.value.title="创建数据",e.value.visible=!0,e.value.formAction="edit",e.value.form=n},F=n=>{Y.confirm(`请仔细确认是否删除 (${n.name}) ?`,"警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{J({id:n.id}).then(t=>{_.warning(t),s()})})},M=()=>{R.value.validate(n=>{for(const t of e.value.form.route)delete t.id;n?e.value.formAction==="add"?K(e.value.form).then(t=>{e.value.visible=!1,_.info(t),s()}):e.value.formAction==="edit"?(O(e.value.form).then(t=>{e.value.visible=!1,_.info(t),s()}),e.value.visible=!1):_.info("提交错误"):_.error("请输入正确的数据！")})};return s(),(n,t)=>{const d=u("el-input"),i=u("el-form-item"),c=u("el-button"),w=u("el-form"),p=u("el-table-column"),x=u("el-switch"),q=u("el-tag"),N=u("el-table"),L=u("el-pagination"),P=u("el-main"),j=u("el-option"),I=u("el-select"),Q=u("el-dialog");return v(),b(y,null,[g("div",null,[l(w,{inline:!0},{default:o(()=>[l(i,{label:"角色名称"},{default:o(()=>[l(d,{modelValue:r.value.query.email,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.query.email=a),placeholder:"角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(c,{type:"primary",icon:"search",onClick:s},{default:o(()=>[f(" 查询 ")]),_:1}),l(c,{type:"info",icon:"Refresh",onClick:B},{default:o(()=>[f(" 重置 ")]),_:1})]),_:1})]),_:1})]),l(P,{class:"ea-table"},{default:o(()=>[l(c,{type:"primary",icon:"Plus",onClick:E},{default:o(()=>[f(" 新建角色 ")]),_:1}),l(N,{data:r.value.data,style:{width:"100%"},onSortChange:z},{default:o(()=>[l(p,{prop:"id",label:"ID",width:"80",sortable:"custom"}),l(p,{prop:"name",label:"名称",width:"150"}),l(p,{prop:"status",label:"状态",width:"120"},{default:o(a=>[l(x,{modelValue:a.row.status,"onUpdate:modelValue":m=>a.row.status=m,"active-value":1,"inactive-value":0,size:"large","inline-prompt":"","active-text":"启用","inactive-text":"禁用",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{prop:"menu",label:"菜单组"},{default:o(a=>[(v(!0),b(y,null,k(a.row.menu,(m,h)=>(v(),C(q,{key:h,style:{margin:"1px"}},{default:o(()=>[f(S(U(m)),1)]),_:2},1024))),128))]),_:1}),l(p,{prop:"route",label:"路由组"},{default:o(a=>[(v(!0),b(y,null,k(a.row.route,(m,h)=>(v(),C(q,{key:h,type:"success",style:{margin:"1px"}},{default:o(()=>[f(S(m.path),1)]),_:2},1024))),128))]),_:1}),l(p,{prop:"createdAt",label:"创建日期",width:"200"}),l(p,{fixed:"right",label:"操作",width:"120"},{default:o(a=>[l(c,{link:"",type:"primary",onClick:m=>T(a.row)},{default:o(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),l(c,{link:"",type:"danger",onClick:m=>F(a.row)},{default:o(()=>[f(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Z,l(L,{background:"",layout:"total, sizes, prev, pager, next",total:r.value.total,"default-page-size":r.value.query.limit,onCurrentChange:D,onSizeChange:$},null,8,["total","default-page-size"])]),_:1}),l(Q,{modelValue:e.value.visible,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.visible=a),title:e.value.title,"close-on-click-modal":!1,"destroy-on-close":"","close-on-press-escape":"",center:""},{footer:o(()=>[g("span",te,[l(c,{onClick:t[5]||(t[5]=a=>e.value.visible=!1)},{default:o(()=>[f("取消")]),_:1}),l(c,{type:"primary",onClick:M},{default:o(()=>[f("确定")]),_:1})])]),default:o(()=>[l(w,{ref_key:"dialogRef",ref:R,model:e.value.form,rules:e.value.formRule},{default:o(()=>[l(i,{label:"名称",prop:"name"},{default:o(()=>[l(d,{modelValue:e.value.form.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.form.name=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:o(()=>[l(x,{modelValue:e.value.form.status,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.form.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),l(i,{label:"前端菜单",prop:"menu"},{default:o(()=>[l(X,{modelValue:e.value.form.menu,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.form.menu=a),filterable:"",placeholder:"开放菜单",multiple:""},null,8,["modelValue"]),ee]),_:1}),le,l(i,{label:"路由组",prop:"route"},{default:o(()=>[l(I,{modelValue:e.value.form.route,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.form.route=a),filterable:"",multiple:"",placeholder:"后端访问路由组","value-key":"id"},{default:o(()=>[(v(!0),b(y,null,k(e.value.routeValue,(a,m)=>(v(),C(j,{key:m,label:`${a.path} - [${a.method}]`,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{re as default};
